function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var o,r=Object.keys(e);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(e),t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)),r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach(function(t){_defineProperty(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _defineProperty(t,e,o){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0===o)return("string"===e?String:Number)(t);o=o.call(t,e||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(l=>{var d={display:function(t){l("tbody").on("click",".toggle-row",function(t){t.preventDefault(),l(this).closest("tr").toggleClass("is-expanded")}),t=l.extend({turbosmtp_get_stats_history_nonce:l("#turbosmtp_get_stats_history_nonce").val(),action:"turbosmtp_get_stats_history",filter:"all"},t),d.init(t)},init:function(t){var o,r=t;l(".tablenav-pages a, .manage-column.sortable a, .manage-column.sorted a").on("click",function(t){t.preventDefault();t=this.search.substring(1),t=l.extend(r,{paged:d.__query(t,"paged")||"1"});d.update(t)}),l("input[name=paged]").on("keyup",function(t){13==t.which&&t.preventDefault();var e=l.extend(r,{paged:parseInt(l("input[name=paged]").val())||"1"});window.clearTimeout(o),o=window.setTimeout(function(){d.update(e)},500)}),l("#email-sent-list").on("submit",function(t){t.preventDefault()}),l("tbody tr").prop("title",""),l(".ts-loading").hide(),l(".history-step").show()},update:function(e){l("#the-list").addClass("table-loading"),l(".ts-history-table-loading").show(),l("#ts-history-table").find("thead").removeClass().addClass(e.filter),l.ajax({url:ajaxurl,data:l.extend({turbosmtp_get_stats_history_nonce:l("#turbosmtp_get_stats_history_nonce").val(),action:"turbosmtp_get_stats_history"},e),success:function(t){(t=l.parseJSON(t)).rows.length&&l("#the-list").html(t.rows),t.column_headers.length&&l("thead tr, tfoot tr").html(t.column_headers),t.pagination.bottom.length&&l(".tablenav.top .tablenav-pages").html(l(t.pagination.top).html()),t.pagination.top.length&&l(".tablenav.bottom .tablenav-pages").html(l(t.pagination.bottom).html()),l("#the-list").removeClass("table-loading"),l(".ts-history-table-loading").hide(),d.init(e)},error:function(){alert(ts.i18n.connection_request_error),l("#the-list").removeClass("table-loading"),l(".ts-history-table-loading").hide()}})},__query:function(t,e){for(var o=t.split("&"),r=0;r<o.length;r++){var n=o[r].split("=");if(n[0]===e)return n[1]}return!1}},c=null;l(function(){$tooltip=l(".error-tooltip"),l(document).on("mouseenter","#ts-history-table tbody tr",function(t){var e=l(this),o=e.find(".column-error").text().trim();""!==o&&($tooltip.text(o),o=e.offset(),$tooltip.css({top:o.top+e.outerHeight(),left:t.pageX,display:"block"}))}),l(document).on("mouseleave","#ts-history-table tbody tr",function(){$tooltip.hide()}),l(document).on("mousemove","#ts-history-table tbody tr",function(t){$tooltip.css({left:t.pageX+10,top:t.pageY+10})}),l(".other-infos-toggle a").on("click",function(t){t.preventDefault(),l(this).find("span").hasClass("icon-arrow-down")?(l("#turbo-stat-chart").hide(),l(this).find("span").removeClass("icon-arrow-down").addClass("icon-arrow-left")):(l("#turbo-stat-chart").show(),l(this).find("span").removeClass("icon-arrow-left").addClass("icon-arrow-down"))});var e=l("input[name='from_date']"),t=moment().subtract(6,"days").startOf("day").toDate(),o=moment().startOf("day").toDate();function s(t,e){switch(t){case"queued":return"rgba(181,181,190,"+e+")";case"delivered":return"rgba(0,144,194,"+e+")";case"bounce":return"rgba(232,193,79,"+e+")";case"opens":return"rgba(0,82,147,"+e+")";case"clicks":return"rgba(104,159,56,"+e+")";case"unsubscribes":return"rgba(235,91,135,"+e+")";case"spam":return"rgba(198,40,40,"+e+")";case"drop":return"rgba(133,133,141,"+e+")";default:return"rgba(72,72,79,"+e+")"}}l(e).daterangepicker({startDate:t,endDate:o,locale:{format:"DD/M/YY",cancelLabel:ts.i18n.drp_preset.cancel,applyLabel:ts.i18n.drp_preset.apply,customRangeLabel:ts.i18n.drp_preset.customrange},ranges:_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},ts.i18n.drp_preset.today,[moment(),moment()]),ts.i18n.drp_preset.yesterday,[moment().subtract(1,"days"),moment().subtract(1,"days")]),ts.i18n.drp_preset.last7days,[moment().subtract(6,"days"),moment()]),ts.i18n.drp_preset.last30days,[moment().subtract(29,"days"),moment()]),ts.i18n.drp_preset.thismonth,[moment().startOf("month"),moment().endOf("month")]),ts.i18n.drp_preset.lastmonth,[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")])}).on("change",function(){r(1)});function i(t,e,o,r){for(var n=0,a=0,s=0;s<e.length;s++)n+=e[s];o=(a=(0===o?0:Number(n/o*100)).toFixed(2)).toString().split("."),r?(l("."+t).find("h4").html(o[0]+".<span>"+o[1]+"%</span>"),l("."+t).find("p").text(n)):l("."+t).find("p").text(a+"%")}var r=function(n){l(".other-infos").hide(),l(".other-infos-columns").hide(),l(".other-infos-loading").show(),l(".other-infos-noresults").hide(),l(".ts-loading").show(),l(".history-step").hide();var a=l(e).data("daterangepicker");l.ajax({url:ajaxurl,method:"POST",dataType:"json",data:{action:"turbosmtp_get_stats_chart",turbosmtp_get_stats_history_nonce:l("#turbosmtp_get_stats_history_nonce").val(),start_date:a.startDate.format("YYYY-MM-DD"),end_date:a.endDate.format("YYYY-MM-DD")},success:function(o){var t,e,r;o.data.stats.aggs&&0==o.data.stats.aggs.length?l(".other-infos-noresults").show():(l("#paid-client").show(),l(".total-email").find("h4").text(o.data.stats.count),l(".chartjs-hidden-iframe").remove(),(c=window.tsAggsChartJs.dataToChartJs(o.data.stats.aggs,a.startDate.format("YYYY-MM-DD"),a.endDate.format("YYYY-MM-DD"),"d",function(t,e){return"delivered"==e||"opens"==e||"clicks"==e||"bounce"==e?i(e,t.data,o.data.stats.count,!0):"all"!=e&&i(e,t.data,o.data.stats.count,!1),_objectSpread(_objectSpread({},t),{},{label:ts.i18n[e],backgroundColor:s(e,.2),borderColor:s(e,1),pointBorderColor:s(e,1),pointBackgroundColor:"#000000",lineTension:0})}))&&(c.labels=c.labels.map(function(t){return moment.unix(t).format("YYYY-MM-DD")})),l(".other-infos").show(),l(".other-infos-columns").css("display","flex"),l(".other-infos-loading").hide(),null!=window.chart&&window.chart.destroy(),t=l("#turbo-stat-chart"),e=t.get(0).getContext("2d"),r=t.parent(),r=l(r),t.attr("width",r.width()),t.attr("height",r.height()/1.5),window.chart=new Chart(e,{type:"line",data:c,options:{responsive:!0,legend:{position:"bottom"},scales:{xAxes:[{ticks:{maxRotation:0,autoSkip:!0,maxTicksLimit:10}}]}}}),0==n?d.display({begin:a.startDate.format("YYYY-MM-DD"),end:a.endDate.format("YYYY-MM-DD")}):d.update({filter:"all",begin:a.startDate.format("YYYY-MM-DD"),end:a.endDate.format("YYYY-MM-DD")}))},error:function(){alert(ts.i18n.connection_request_error)}})};l("div[data-ts-filter]").on("click",function(){var t=l(e).data("daterangepicker");l("div[data-ts-filter]").removeClass("active"),l(this).addClass("active"),d.update({filter:l(this).data("ts-filter"),begin:t.startDate.format("YYYY-MM-DD"),end:t.endDate.format("YYYY-MM-DD")})}),r(0)})})(jQuery);