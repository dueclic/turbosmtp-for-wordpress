function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(t,e,a){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0===a)return("string"===e?String:Number)(t);a=a.call(t,e||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}(l=>{var d={display:function(t){l("tbody").on("click",".toggle-row",function(t){t.preventDefault(),l(this).closest("tr").toggleClass("is-expanded")}),t=l.extend({_ajax_custom_list_nonce:l("#_ajax_custom_list_nonce").val(),action:"_ajax_fetch_ts_history",filter:"all"},t),d.init(t)},init:function(t){var a,n=t;l(".tablenav-pages a, .manage-column.sortable a, .manage-column.sorted a").on("click",function(t){t.preventDefault();t=this.search.substring(1),t=l.extend(n,{paged:d.__query(t,"paged")||"1"});console.log(t),d.update(t)}),l("input[name=paged]").on("keyup",function(t){13==t.which&&t.preventDefault();var e=l.extend(n,{paged:parseInt(l("input[name=paged]").val())||"1"});console.log(e),window.clearTimeout(a),a=window.setTimeout(function(){d.update(e)},500)}),l("#email-sent-list").on("submit",function(t){t.preventDefault()}),l("tbody tr").prop("title",""),l(".ts-loading").hide(),l(".history-step").show()},update:function(e){l("#the-list").addClass("table-loading"),l(".ts-history-table-loading").show(),l("#ts-history-table").find("thead").removeClass().addClass(e.filter),l.ajax({url:ajaxurl,data:l.extend({_ajax_custom_list_nonce:l("#_ajax_custom_list_nonce").val(),action:"_ajax_fetch_ts_history"},e),success:function(t){(t=l.parseJSON(t)).rows.length&&l("#the-list").html(t.rows),t.column_headers.length&&l("thead tr, tfoot tr").html(t.column_headers),t.pagination.bottom.length&&l(".tablenav.top .tablenav-pages").html(l(t.pagination.top).html()),t.pagination.top.length&&l(".tablenav.bottom .tablenav-pages").html(l(t.pagination.bottom).html()),l("#the-list").removeClass("table-loading"),l(".ts-history-table-loading").hide(),d.init(e)}})},__query:function(t,e){for(var a=t.split("&"),n=0;n<a.length;n++){var o=a[n].split("=");if(o[0]===e)return o[1]}return!1}},c=null;l(function(){l(".other-infos-toggle a").on("click",function(t){t.preventDefault(),l(this).find("span").hasClass("icon-arrow-down")?(l("#turbo-stat-chart").hide(),l(this).find("span").removeClass("icon-arrow-down").addClass("icon-arrow-left")):(l("#turbo-stat-chart").show(),l(this).find("span").removeClass("icon-arrow-left").addClass("icon-arrow-down"))});var e=l("input[name='from_date']"),t=moment().subtract(7,"days").startOf("day").toDate(),a=moment().startOf("day").toDate();function s(t,e){switch(t){case"queued":return"rgba(181,181,190,"+e+")";case"delivered":return"rgba(0,144,194,"+e+")";case"bounce":return"rgba(232,193,79,"+e+")";case"opens":return"rgba(0,82,147,"+e+")";case"clicks":return"rgba(104,159,56,"+e+")";case"unsubscribes":return"rgba(235,91,135,"+e+")";case"spam":return"rgba(198,40,40,"+e+")";case"drop":return"rgba(133,133,141,"+e+")";default:return"rgba(72,72,79,"+e+")"}}l(e).daterangepicker({startDate:t,endDate:a,locale:{format:"DD/M/YY",cancelLabel:ts.i18n.drp_preset.cancel,applyLabel:ts.i18n.drp_preset.apply,customRangeLabel:ts.i18n.drp_preset.customrange},ranges:_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},ts.i18n.drp_preset.today,[moment(),moment()]),ts.i18n.drp_preset.yesterday,[moment().subtract(1,"days"),moment().subtract(1,"days")]),ts.i18n.drp_preset.last7days,[moment().subtract(6,"days"),moment()]),ts.i18n.drp_preset.last30days,[moment().subtract(29,"days"),moment()]),ts.i18n.drp_preset.thismonth,[moment().startOf("month"),moment().endOf("month")]),ts.i18n.drp_preset.lastmonth,[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")])}).on("change",function(){n(1)});function i(t,e,a,n){for(var o=0,r=0,s=0;s<e.length;s++)o+=e[s];a=(r=(0===a?0:Number(o/a*100)).toFixed(2)).toString().split("."),n?(l("."+t).find("h4").html(a[0]+".<span>"+a[1]+"%</span>"),l("."+t).find("p").text(o)):l("."+t).find("p").text(r+"%")}var n=function(o){l(".other-infos").hide(),l(".other-infos-columns").hide(),l(".other-infos-loading").show(),l(".other-infos-noresults").hide(),l(".ts-loading").show(),l(".history-step").hide();var r=l(e).data("daterangepicker");l.ajax({url:ts.chart_ajax_url,method:"POST",dataType:"json",data:{start_date:r.startDate.format("YYYY-MM-DD"),end_date:r.endDate.format("YYYY-MM-DD")},success:function(a){var t,e,n;a.data.stats.aggs&&0==a.data.stats.aggs.length?l(".other-infos-noresults").show():(l("#paid-client").show(),l(".total-email").find("h4").text(a.data.stats.count),l(".chartjs-hidden-iframe").remove(),c=window.tsAggsChartJs.dataToChartJs(a.data.stats.aggs,r.startDate.format("YYYY-MM-DD"),r.endDate.format("YYYY-MM-DD"),"d",function(t,e){return"delivered"==e||"opens"==e||"clicks"==e||"bounce"==e?i(e,t.data,a.data.stats.count,!0):"all"!=e&&i(e,t.data,a.data.stats.count,!1),_objectSpread(_objectSpread({},t),{},{label:ts.i18n[e],backgroundColor:s(e,.2),borderColor:s(e,1),pointBorderColor:s(e,1),pointBackgroundColor:"#000000",lineTension:0})}),l(".other-infos").show(),l(".other-infos-columns").css("display","flex"),l(".other-infos-loading").hide(),null!=window.chart&&window.chart.destroy(),t=l("#turbo-stat-chart"),e=t.get(0).getContext("2d"),n=t.parent(),n=l(n),t.attr("width",n.width()),t.attr("height",n.height()/1.5),window.chart=new Chart(e,{type:"line",data:c,options:{responsive:!0,legend:{position:"bottom"},scales:{xAxes:[{ticks:{maxRotation:0,autoSkip:!0,maxTicksLimit:10}}]}}}),0==o?d.display({begin:r.startDate.format("YYYY-MM-DD"),end:r.endDate.format("YYYY-MM-DD")}):d.update({filter:"all",begin:r.startDate.format("YYYY-MM-DD"),end:r.endDate.format("YYYY-MM-DD")}))}})};l("div[data-ts-filter]").on("click",function(){var t=l(e).data("daterangepicker");l("div[data-ts-filter]").removeClass("active"),l(this).addClass("active"),d.update({filter:l(this).data("ts-filter"),begin:t.startDate.format("YYYY-MM-DD"),end:t.endDate.format("YYYY-MM-DD")})}),n(0)})})(jQuery);