function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var r,o=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)),o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(t,e,r){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(d=>{var t=d("#turbosmtp-messages-list-table"),r=t.find("tbody"),o=t.find("thead, tfoot"),l={display:function(t){r.on("click",".toggle-row",function(t){t.preventDefault(),d(this).closest("tr").toggleClass("is-expanded")}),t=d.extend({turbosmtp_get_stats_history_nonce:d("#turbosmtp_get_stats_history_nonce").val(),action:"turbosmtp_get_stats_history",filter:"all"},t),l.init(t)},init:function(t){var r,o=t;d(".tablenav-pages a, .manage-column.sortable a, .manage-column.sorted a").on("click",function(t){t.preventDefault();var t=this.search.substring(1),e=d.extend(o,{paged:l.__query(t,"paged")||"1"}),r=l.__query(t,"orderby"),t=l.__query(t,"order");r&&(e.orderby=r),t&&(e.order=t),l.update(e)}),d("input[name=paged]").on("keyup",function(t){13==t.which&&t.preventDefault();var e=d.extend(o,{paged:parseInt(d("input[name=paged]").val())||"1"});window.clearTimeout(r),r=window.setTimeout(function(){l.update(e)},500)}),d("#email-sent-list").on("submit",function(t){t.preventDefault()}),d("tbody tr").prop("title",""),d(".ts-loading").hide(),d(".history-step").show()},update:function(e){r.addClass("table-loading"),d(".ts-history-table-loading").show(),o.removeClass().addClass(e.filter),d.ajax({url:ajaxurl,data:d.extend({turbosmtp_get_stats_history_nonce:d("#turbosmtp_get_stats_history_nonce").val(),action:"turbosmtp_get_stats_history"},e),success:function(t){(t=d.parseJSON(t)).rows.length&&r.html(t.rows),t.column_headers.length&&o.find("tr").html(t.column_headers),t.pagination.bottom.length&&d(".tablenav.top .tablenav-pages").html(d(t.pagination.top).html()),t.pagination.top.length&&d(".tablenav.bottom .tablenav-pages").html(d(t.pagination.bottom).html()),r.removeClass("table-loading"),d(".ts-history-table-loading").hide(),l.init(e)},error:function(){alert(ts.i18n.connection_request_error),r.removeClass("table-loading"),d(".ts-history-table-loading").hide()}})},__query:function(t,e){for(var r=t.split("&"),o=0;o<r.length;o++){var n=r[o].split("=");if(n[0]===e)return n[1]}return!1}},c=null;d(function(){var o=d(".error-tooltip"),e=(d(document).on("mouseenter","#ts-history-table tbody tr",function(t){var e=d(this),r=e.find(".column-error").text().trim();""!==r&&(o.text(r),r=e.offset(),o.css({top:r.top+e.outerHeight(),left:t.pageX,display:"block"}))}),d(document).on("mouseleave","#ts-history-table tbody tr",function(){o.hide()}),d(document).on("mousemove","#ts-history-table tbody tr",function(t){o.css({left:t.pageX+10,top:t.pageY+10})}),d(".other-infos-toggle a").on("click",function(t){t.preventDefault(),d(this).find("span").hasClass("icon-arrow-down")?(d("#turbo-stat-chart").hide(),d(this).find("span").removeClass("icon-arrow-down").addClass("icon-arrow-left")):(d("#turbo-stat-chart").show(),d(this).find("span").removeClass("icon-arrow-left").addClass("icon-arrow-down"))}),d("input[name='from_date']")),t=moment().subtract(6,"days").startOf("day").toDate(),r=moment().startOf("day").toDate();function s(t,e){switch(t){case"queued":return"rgba(181,181,190,"+e+")";case"delivered":return"rgba(0,144,194,"+e+")";case"bounce":return"rgba(232,193,79,"+e+")";case"opens":return"rgba(0,82,147,"+e+")";case"clicks":return"rgba(104,159,56,"+e+")";case"unsubscribes":return"rgba(235,91,135,"+e+")";case"spam":return"rgba(198,40,40,"+e+")";case"drop":return"rgba(133,133,141,"+e+")";default:return"rgba(72,72,79,"+e+")"}}d(e).daterangepicker({startDate:t,endDate:r,locale:{format:"DD/M/YY",cancelLabel:ts.i18n.drp_preset.cancel,applyLabel:ts.i18n.drp_preset.apply,customRangeLabel:ts.i18n.drp_preset.customrange},ranges:_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},ts.i18n.drp_preset.today,[moment(),moment()]),ts.i18n.drp_preset.yesterday,[moment().subtract(1,"days"),moment().subtract(1,"days")]),ts.i18n.drp_preset.last7days,[moment().subtract(6,"days"),moment()]),ts.i18n.drp_preset.last30days,[moment().subtract(29,"days"),moment()]),ts.i18n.drp_preset.thismonth,[moment().startOf("month"),moment().endOf("month")]),ts.i18n.drp_preset.lastmonth,[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")])}).on("change",function(){n(1)});function i(t,e,r,o){for(var n=0,a=0,s=0;s<e.length;s++)n+=e[s];r=(a=(0===r?0:Number(n/r*100)).toFixed(2)).toString().split("."),o?(d("."+t).find("h4").html(r[0]+".<span>"+r[1]+"%</span>"),d("."+t).find("p").text(n)):d("."+t).find("p").text(a+"%")}var n=function(n){d(".other-infos").hide(),d(".other-infos-columns").hide(),d(".other-infos-loading").show(),d(".other-infos-noresults").hide(),d(".ts-loading").show(),d(".history-step").hide();var a=d(e).data("daterangepicker");d.ajax({url:ajaxurl,method:"POST",dataType:"json",data:{action:"turbosmtp_get_stats_chart",turbosmtp_get_stats_history_nonce:d("#turbosmtp_get_stats_history_nonce").val(),start_date:a.startDate.format("YYYY-MM-DD"),end_date:a.endDate.format("YYYY-MM-DD")},success:function(r){var t,e,o;r.data.stats.aggs&&0==r.data.stats.aggs.length?d(".other-infos-noresults").show():(d("#paid-client").show(),d(".total-email").find("h4").text(r.data.stats.count),d(".chartjs-hidden-iframe").remove(),(c=window.tsAggsChartJs.dataToChartJs(r.data.stats.aggs,a.startDate.format("YYYY-MM-DD"),a.endDate.format("YYYY-MM-DD"),"d",function(t,e){return"delivered"==e||"opens"==e||"clicks"==e||"bounce"==e?i(e,t.data,r.data.stats.count,!0):"all"!=e&&i(e,t.data,r.data.stats.count,!1),_objectSpread(_objectSpread({},t),{},{label:ts.i18n[e],backgroundColor:s(e,.2),borderColor:s(e,1),pointBorderColor:s(e,1),pointBackgroundColor:"#000000",lineTension:0})}))&&(c.labels=c.labels.map(function(t){return moment.unix(t).format("YYYY-MM-DD")})),d(".other-infos").show(),d(".other-infos-columns").css("display","flex"),d(".other-infos-loading").hide(),null!=window.chart&&window.chart.destroy(),t=d("#turbo-stat-chart"),e=t.get(0).getContext("2d"),o=t.parent(),o=d(o),t.attr("width",o.width()),t.attr("height",o.height()/1.5),window.chart=new Chart(e,{type:"line",data:c,options:{responsive:!0,legend:{position:"bottom"},scales:{xAxes:[{ticks:{maxRotation:0,autoSkip:!0,maxTicksLimit:10}}]}}}),0==n?l.display({begin:a.startDate.format("YYYY-MM-DD"),end:a.endDate.format("YYYY-MM-DD")}):l.update({filter:"all",begin:a.startDate.format("YYYY-MM-DD"),end:a.endDate.format("YYYY-MM-DD")}))},error:function(){alert(ts.i18n.connection_request_error)}})};d("div[data-ts-filter]").on("click",function(){var t=d(e).data("daterangepicker");d("div[data-ts-filter]").removeClass("active"),d(this).addClass("active"),l.update({filter:d(this).data("ts-filter"),begin:t.startDate.format("YYYY-MM-DD"),end:t.endDate.format("YYYY-MM-DD")})}),n(0)})})(jQuery);